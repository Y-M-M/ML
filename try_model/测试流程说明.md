# ç”µè¡¨è¯»æ•°è¯†åˆ« - è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

`run_test_pipeline.py` æ˜¯ä¸€ä¸ªåŸºäº `run_complete_pipeline.py` è®¾è®¡çš„è‡ªåŠ¨åŒ–æµ‹è¯•å…¨æµç¨‹è„šæœ¬ï¼Œä¸“é—¨ç”¨äºæµ‹è¯•å’Œè¯„ä¼°ç”µè¡¨è¯»æ•°è¯†åˆ«ç³»ç»Ÿçš„æ€§èƒ½ã€‚

## ğŸ“‹ ä¸»è¦åŠŸèƒ½

### 1. ç¯å¢ƒæ£€æŸ¥ ğŸ”
- âœ… æ£€æŸ¥æ¨¡å‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆYOLO + CRNNï¼‰
- âœ… æ£€æŸ¥æµ‹è¯•æ•°æ®å‡†å¤‡çŠ¶æ€
- âœ… è‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æ¨¡å‹æ–‡ä»¶

### 2. æ¨ç†æµ‹è¯• ğŸš€
- âœ… æ”¯æŒå¤šç§æµ‹è¯•æ¨¡å¼ï¼švalidationã€allã€comprehensive
- âœ… è‡ªåŠ¨è¿è¡Œç«¯åˆ°ç«¯æ¨ç†
- âœ… ç”Ÿæˆé¢„æµ‹ç»“æœæ–‡ä»¶

### 3. æ¨¡å‹è¯„ä¼° ğŸ“Š
- âœ… è¿è¡Œè¯¦ç»†çš„æ¨¡å‹æ€§èƒ½è¯„ä¼°
- âœ… æå–å…³é”®æ€§èƒ½æŒ‡æ ‡

### 4. ç»“æœåˆ†æ ğŸ“ˆ
- âœ… è‡ªåŠ¨åˆ†ææµ‹è¯•ç»“æœ
- âœ… ç”Ÿæˆè¯¦ç»†çš„JSONæ ¼å¼æµ‹è¯•æŠ¥å‘Š
- âœ… æ£€æŸ¥æ‰€æœ‰è¾“å‡ºæ–‡ä»¶

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

```bash
# è¿è¡Œé»˜è®¤æµ‹è¯•ï¼ˆéªŒè¯é›†æ¨¡å¼ï¼‰
python run_test_pipeline.py

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
python run_test_pipeline.py --help
```

### é«˜çº§é…ç½®

```bash
# ä½¿ç”¨ç‰¹å®šCRNNæ¨¡å‹è¿›è¡Œæµ‹è¯•
python run_test_pipeline.py --crnn_model crnn_improved_best.pth

# è¿è¡Œå…¨æ•°æ®é›†æµ‹è¯•
python run_test_pipeline.py --test_mode all

# è¿è¡Œç»¼åˆæµ‹è¯•ï¼ˆå¤šç§æ¨¡å¼ï¼‰
python run_test_pipeline.py --test_mode comprehensive

# è·³è¿‡æ¨ç†æµ‹è¯•ï¼Œä»…è¿›è¡Œæ¨¡å‹è¯„ä¼°
python run_test_pipeline.py --skip_inference

# è·³è¿‡æ¨¡å‹è¯„ä¼°ï¼Œä»…è¿›è¡Œæ¨ç†æµ‹è¯•
python run_test_pipeline.py --skip_evaluation

# è‡ªå®šä¹‰æŠ¥å‘Šæ–‡ä»¶å
python run_test_pipeline.py --report_file my_test_report.json
```

## âš™ï¸ å‚æ•°è¯´æ˜

| å‚æ•° | é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--test_mode` | validation/all/comprehensive | validation | æµ‹è¯•æ¨¡å¼ |
| `--crnn_model` | æ–‡ä»¶è·¯å¾„ | crnn_improved_best.pth | CRNNæ¨¡å‹æ–‡ä»¶ |
| `--skip_inference` | æ ‡å¿— | False | è·³è¿‡æ¨ç†æµ‹è¯• |
| `--skip_evaluation` | æ ‡å¿— | False | è·³è¿‡æ¨¡å‹è¯„ä¼° |
| `--report_file` | æ–‡ä»¶å | auto_test_report.json | æµ‹è¯•æŠ¥å‘Šæ–‡ä»¶å |

## ğŸ“Š æµ‹è¯•æ¨¡å¼è¯¦è§£

### 1. validation æ¨¡å¼
- ğŸ¯ åœ¨éªŒè¯é›†ä¸Šè¿›è¡Œæµ‹è¯•
- ğŸ“ ä½¿ç”¨ `yolov8_dataset/images/val` ç›®å½•
- ğŸ“ˆ è®¡ç®—å‡†ç¡®ç‡å’Œè¯¦ç»†æŒ‡æ ‡

### 2. all æ¨¡å¼
- ğŸ¯ åœ¨å…¨éƒ¨æ•°æ®é›†ä¸Šè¿›è¡Œæµ‹è¯•
- ğŸ“ ä½¿ç”¨ `Dataset` ç›®å½•ï¼ˆ840å¼ å›¾åƒï¼‰
- ğŸ“ˆ å…¨é¢çš„æ€§èƒ½è¯„ä¼°

### 3. comprehensive æ¨¡å¼
- ğŸ¯ è¿è¡Œå¤šç§æµ‹è¯•æ¨¡å¼
- ğŸ“Š ç”Ÿæˆæœ€å…¨é¢çš„æµ‹è¯•æŠ¥å‘Š
- â±ï¸ æ‰§è¡Œæ—¶é—´è¾ƒé•¿ä½†ç»“æœæœ€å®Œæ•´

## ğŸ“ è¾“å‡ºæ–‡ä»¶

### é¢„æµ‹ç»“æœæ–‡ä»¶
- `validation_predictions.csv` - éªŒè¯é›†é¢„æµ‹ç»“æœ
- `all_predictions.csv` - å…¨æ•°æ®é›†é¢„æµ‹ç»“æœ
- `test_predictions.csv` - æµ‹è¯•é›†é¢„æµ‹ç»“æœ

### æµ‹è¯•æŠ¥å‘Š
- `auto_test_report.json` - è¯¦ç»†çš„JSONæ ¼å¼æµ‹è¯•æŠ¥å‘Š
- åŒ…å«ï¼š
  - æµ‹è¯•é…ç½®ä¿¡æ¯
  - æ¨¡å‹å¯ç”¨çŠ¶æ€
  - æ•°æ®å‡†å¤‡çŠ¶æ€
  - æµ‹è¯•ç»“æœå’Œæ€§èƒ½æŒ‡æ ‡
  - æ—¶é—´æˆ³å’Œæ–‡ä»¶ä¿¡æ¯

## ğŸ”§ ä¾èµ–è¦æ±‚

### å¿…éœ€æ–‡ä»¶
- `inference_pipeline_fixed.py` - æ¨ç†è„šæœ¬
- `test_model.py` - æ¨¡å‹è¯„ä¼°è„šæœ¬ï¼ˆå¯é€‰ï¼‰
- `Dataset/labels.csv` - æ ‡ç­¾æ–‡ä»¶

### å¿…éœ€æ¨¡å‹
è‡³å°‘éœ€è¦ä»¥ä¸‹æ¨¡å‹ä¹‹ä¸€ï¼š
- `runs/detect/meter_detection/weights/best.pt` - YOLOæ£€æµ‹æ¨¡å‹
- `crnn_improved_best.pth` - CRNNè¯†åˆ«æ¨¡å‹
- `crnn_recognizer_best.pth` - å¤‡ç”¨CRNNæ¨¡å‹

### æµ‹è¯•æ•°æ®
- `yolov8_dataset/images/val/` - éªŒè¯é›†å›¾åƒ
- `Dataset/` - åŸå§‹æ•°æ®é›†

## ğŸ“ˆ ç»“æœè§£è¯»

### æµ‹è¯•æŠ¥å‘Šç»“æ„
```json
{
  "timestamp": "2025-01-01T12:00:00",
  "tests_run": [
    {
      "test_name": "æ¨ç†æµ‹è¯•_validation",
      "result": "æ•´ä½“ç«¯åˆ°ç«¯è¯†åˆ«å‡†ç¡®ç‡: 85.00% (143/168)"
    }
  ],
  "config": {
    "test_mode": "validation",
    "crnn_model": "crnn_improved_best.pth",
    "available_models": {...},
    "data_status": {...},
    "prediction_files": [...]
  }
}
```

### å…³é”®æŒ‡æ ‡
- **ç«¯åˆ°ç«¯è¯†åˆ«å‡†ç¡®ç‡**: å®Œæ•´çš„æ£€æµ‹+è¯†åˆ«æµç¨‹å‡†ç¡®ç‡
- **å¤„ç†å›¾åƒæ•°é‡**: æˆåŠŸå¤„ç†çš„å›¾åƒæ€»æ•°
- **æ¨¡å‹æ€§èƒ½**: å„ä¸ªå­æ¨¡å—çš„è¯¦ç»†æ€§èƒ½

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡è¿è¡Œ**: ä½¿ç”¨é»˜è®¤è®¾ç½®å¿«é€Ÿæµ‹è¯•
   ```bash
   python run_test_pipeline.py
   ```

2. **æ€§èƒ½è¯„ä¼°**: è¿è¡Œç»¼åˆæµ‹è¯•è·å¾—æœ€å…¨é¢çš„ç»“æœ
   ```bash
   python run_test_pipeline.py --test_mode comprehensive
   ```

3. **è°ƒè¯•æ¨¡å¼**: è·³è¿‡è€—æ—¶çš„æ­¥éª¤è¿›è¡Œå¿«é€Ÿè°ƒè¯•
   ```bash
   python run_test_pipeline.py --skip_evaluation
   ```

4. **ç»“æœæŸ¥çœ‹**: æ£€æŸ¥ç”Ÿæˆçš„æŠ¥å‘Šå’Œé¢„æµ‹æ–‡ä»¶
   ```bash
   cat auto_test_report.json | jq .
   head validation_predictions.csv
   ```

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
```bash
âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å¯ç”¨çš„æ¨¡å‹ï¼Œè¯·å…ˆè®­ç»ƒæ¨¡å‹!
```
**è§£å†³æ–¹æ¡ˆ**: å…ˆè¿è¡Œè®­ç»ƒæµç¨‹æˆ–ç¡®ä¿æ¨¡å‹æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®

### é—®é¢˜2: æ•°æ®ç›®å½•ä¸å­˜åœ¨
```bash
âŒ éªŒè¯é›†å›¾åƒ: ä¸å­˜åœ¨
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿å·²è¿è¡Œæ•°æ®å‡†å¤‡æµç¨‹

### é—®é¢˜3: æ¨ç†è„šæœ¬ç¼ºå¤±
```bash
âŒ å‘½ä»¤æ‰§è¡Œå¤±è´¥: python inference_pipeline_fixed.py
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿ `inference_pipeline_fixed.py` æ–‡ä»¶å­˜åœ¨ä¸”å¯æ‰§è¡Œ

---

ğŸ“§ å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥æµ‹è¯•æŠ¥å‘Šä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚ 